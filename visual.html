<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GlacioNet | Visualization Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <link href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" rel="stylesheet" />
  <style>
    :root { --primary-blue: #2563eb; --secondary-blue:#1e40af; --light-bg:#f8fafc; }
    body { font-family: 'Segoe UI', sans-serif; background: var(--light-bg); }
    .dashboard-header { background: linear-gradient(135deg, var(--primary-blue), var(--secondary-blue)); color: white; padding: 2rem; }
    #map { height: 450px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.2); }
    .year-display { font-size: 2rem; font-weight: bold; color: var(--primary-blue); text-align: center; }
    canvas { background: #fff; border-radius: 8px; padding: 0.5rem; }
    .download-card { border: 2px solid #e2e8f0; border-radius: 12px; padding: 1rem; text-align: center; transition: 0.3s; cursor: pointer; }
    .download-card:hover { border-color: var(--primary-blue); transform: translateY(-2px); }
    .download-icon { font-size: 2rem; color: var(--primary-blue); }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="dashboard-header text-center">
    <h1>GlacioNet | Visualization Dashboard</h1>
    <p>Explore Glacier Retreat & Water Stress Trends (2003â€“2022)</p>
  </header>

  <main class="container my-4">
    <div class="row g-4">
      <!-- Map -->
      <div class="col-lg-8">
        <h4><i class="fas fa-map"></i> Glacier & Water Stress Map</h4>
        <div id="map"></div>
      </div>

      <!-- Timeline -->
      <div class="col-lg-4 text-center">
        <h4><i class="fas fa-clock"></i> Timeline</h4>
        <div class="year-display" id="yearDisplay">2003</div>
        <input type="range" id="timeSlider" class="form-range" min="2003" max="2022" value="2003">
        <div class="d-flex justify-content-between"><small>2003</small><small>2022</small></div>
        <div class="mt-3">
          <button class="btn btn-primary" id="playBtn"><i class="fas fa-play"></i> Play</button>
          <button class="btn btn-danger" id="pauseBtn" style="display:none"><i class="fas fa-pause"></i> Pause</button>
        </div>
      </div>
    </div>

    <!-- Charts -->
    <div class="row g-4 mt-4">
      <div class="col-md-6">
        <h5><i class="fas fa-chart-area"></i> Glacier Melt Trends</h5>
        <canvas id="glacierChart"></canvas>
      </div>
      <div class="col-md-6">
        <h5><i class="fas fa-water"></i> FSI Trends</h5>
        <canvas id="fsiChart"></canvas>
      </div>
    </div>

    <!-- Downloads -->
    <div class="row g-4 mt-4">
      <div class="col-md-4">
        <div class="download-card" onclick="alert('Exporting CSV...')">
          <div class="download-icon"><i class="fas fa-file-csv"></i></div>
          <b>Export CSV</b><br><small>Download raw dataset</small>
        </div>
      </div>
      <div class="col-md-4">
        <div class="download-card" onclick="alert('Generating PDF report...')">
          <div class="download-icon"><i class="fas fa-file-pdf"></i></div>
          <b>PDF Report</b><br><small>Full analysis with charts</small>
        </div>
      </div>
      <div class="col-md-4">
        <div class="download-card" onclick="alert('Capturing screenshot...')">
          <div class="download-icon"><i class="fas fa-camera"></i></div>
          <b>Screenshot</b><br><small>Save dashboard view</small>
        </div>
      </div>
    </div>
  </main>

  <!-- Scripts -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    let map, glacierLayer, stressMarkers=[], playInterval, isPlaying=false;
    const years = Array.from({length:20}, (_,i)=>2003+i);

    // Fake glacier + FSI dataset
    const data = years.map(y=>({
      year:y,
      glacier: 100 - (y-2003)*2.2 + Math.random()*2, // % of 2003 volume
      fsi: 0.3 + (y-2003)*0.035 + (Math.random()*0.1)
    }));

    // Simplified glacier polygons (demo only!)
    const glacierData = {
      2003: { "type":"FeatureCollection","features":[
        { "type":"Feature","geometry":{"type":"Polygon","coordinates":[[[79,30.3],[79.3,30.3],[79.3,30.6],[79,30.6]]]}}
      ]},
      2022: { "type":"FeatureCollection","features":[
        { "type":"Feature","geometry":{"type":"Polygon","coordinates":[[[79,30.3],[79.15,30.3],[79.15,30.55],[79,30.55]]]}}
      ]}
    };

    function initMap(){
      map=L.map('map').setView([30.3,79.1],7);
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
      showYear(2003);
    }

    function showGlacier(year){
      if(glacierLayer) map.removeLayer(glacierLayer);
      glacierLayer=L.geoJSON(glacierData[year]||glacierData[2022],
        {style:{color:"blue",fillColor:"lightblue",fillOpacity:0.4}}).addTo(map);
    }

    function showStress(year){
      stressMarkers.forEach(m=>map.removeLayer(m));
      stressMarkers=[];
      const base=data.find(d=>d.year===year).fsi;
      const zones=[
        {name:"Uttarakhand",coords:[30.0668,79.0193],stress:base*0.9},
        {name:"Himachal",coords:[31.1048,77.1734],stress:base*1.1},
        {name:"Ladakh",coords:[34.1526,77.5770],stress:base*1.2},
        {name:"Sikkim",coords:[27.533,88.512],stress:base*0.8}
      ];
      zones.forEach(z=>{
        const color=z.stress<0.5?'green':z.stress<1?'orange':'red';
        const marker=L.circle(z.coords,{color,fillColor:color,fillOpacity:0.5,radius:50000})
          .bindPopup(`<b>${z.name}</b><br>FSI: ${z.stress.toFixed(2)} (${year})`);
        marker.addTo(map); stressMarkers.push(marker);
      });
    }

    function showYear(year){
      document.getElementById('yearDisplay').textContent=year;
      document.getElementById('timeSlider').value=year;
      showGlacier(year);
      showStress(year);
    }

    // Charts
    let glacierChart,fsiChart;
    function initCharts(){
      glacierChart=new Chart(document.getElementById('glacierChart'),{
        type:'line',
        data:{labels:years,datasets:[{label:'Glacier Volume (% of 2003)',data:data.map(d=>d.glacier),borderColor:'#2563eb',fill:false}]}
      });
      fsiChart=new Chart(document.getElementById('fsiChart'),{
        type:'line',
        data:{labels:years,datasets:[{label:'FSI Index',data:data.map(d=>d.fsi),borderColor:'#f59e0b',fill:false}]}
      });
    }

    // Playback
    function playTimeline(){
      if(isPlaying) return;
      isPlaying=true;
      document.getElementById('playBtn').style.display='none';
      document.getElementById('pauseBtn').style.display='inline-block';
      let year=parseInt(document.getElementById('timeSlider').value);
      playInterval=setInterval(()=>{
        year=year>=2022?2003:year+1;
        showYear(year);
      },1000);
    }
    function pauseTimeline(){
      clearInterval(playInterval);
      isPlaying=false;
      document.getElementById('playBtn').style.display='inline-block';
      document.getElementById('pauseBtn').style.display='none';
    }

    document.addEventListener('DOMContentLoaded',()=>{
      initMap();
      initCharts();
      document.getElementById('timeSlider').addEventListener('input',e=>showYear(parseInt(e.target.value)));
      document.getElementById('playBtn').addEventListener('click',playTimeline);
      document.getElementById('pauseBtn').addEventListener('click',pauseTimeline);
    });
  </script>
</body>
</html>
